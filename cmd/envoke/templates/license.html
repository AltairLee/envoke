{{define "head"}}
  <title>{{ .Title}}</title>
{{end}}

{{define "body"}}
<header>PUBISHING LICENSE</header>
<form id="publishing-license-form" name="publishing-license-form">
    <input type="text" name="compositionId" placeholder="COMPOSITION ID" required /><br>
    <input type="text" name="licenseeId" placeholder="LICENSEE ID" required /><br>
    <select form="publishing-license-form" name="licenseType" required>
        <option value="" disabled selected>SELECT TYPE</option>
        <option value="mechanical_license">MECHANICAL</option>
        <option value="synchronization_license">SYNCHRONIZATION</option>
    </select>
    <label>VALID FROM</label>
    <input type="date" name="validFrom" required /><br>
    <label>VALID TO</label>
    <input type="date" name="validTo" required /><br>
    <input type="submit" value="submit" />
</form>
<header>RECORDING LICENSE</header>
<form id="recording-license-form" name="recording-license-form">
    <input type="text" name="recordingId" placeholder="RECORDING ID" required /><br>
    <input type="text" name="licenseeId" placeholder="LICENSEE ID" required /><br>
    <select form="recording-license-form" name="licenseType" required>
        <option value="" disabled selected>SELECT TYPE</option>
        <option value="master_license">MASTER</option>
    </select>
    <label>VALID FROM</label>
    <input type="date" name="validFrom" required /><br>
    <label>VALID TO</label>
    <input type="date" name="validTo" required /><br>
    <input type="submit" value="submit" />
</form>
<header>SEARCH</header>
<form id="search-form" name="search-form">
    <input type="text" name="modelId" placeholder="LICENSE ID" required /><br>
    <select form="search-form" name="field" required>
        <option value="" disabled selected></option>
        <option value="composition">COMPOSITION</option>
        <option value="licensee">LICENSEE</option>
        <option value="licenser">LICENSER</option>
        <option value="recording">RECORDING</option>
    </select>
    <input type="submit" value="search" />
</form>
<pre id="message"></pre>
<script type="text/javascript">

function httpPostAsync(addr, data, callback) {
    var xhr = new XMLHttpRequest ();
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                callback(xhr.responseText);
            } else {
                alert(xhr.responseText);
            };
        };
    };
    xhr.open("POST", addr, true); 
    xhr.send(data);
};

var callback = function(responseText) {
    var json = JSON.parse(responseText);
    var str = JSON.stringify(json,null,2);
    $("#message").text(str);
};

window.onload = function() {

    var publishingLicenseForm = $("#publishing-license-form");
    publishingLicenseForm.submit(function(event) {
        event.preventDefault();
        var formData = publishingLicenseForm.serialize();
        httpPostAsync("http://localhost:8888/publishing_license", formData, callback);
    });

    var recordingLicenseForm = $("#recording-license-form");
    recordingLicenseForm.submit(function(event){
        event.preventDefault();
        var formData = recordingLicenseForm.serialize();
        httpPostAsync("http://localhost:8888/recording_license", formData, callback);
    });

    var searchForm = $("#search-form");
    searchForm.submit(function(event){
        event.preventDefault();
        var formData = searchForm.serialize();
        httpPostAsync("http://localhost:8888/search", formData, callback);
    });
}
</script>
{{end}}